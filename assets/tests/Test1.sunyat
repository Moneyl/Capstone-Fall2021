
;;; Test1.sunyat
;;; Simple infinite loop. Switches between forward and backwards movement periodically

const MOVE_SPEED 100
const TURN_RATE 20
const MOVE_DURATION 50 ; How long to move in one direction before moving in the other

; Increment r0 forever
!main
add r0 1
mov r2 TURN_RATE
store P_STEERING r2 ; Constant turning

; if r0 > 15 then move forward,
cmp r0 MOVE_DURATION
jgr !forward
; if r0 > 0 && <= 15 then move backward
cmp r0 MOVE_DURATION
jls !backward

; if r0 >= 30, r1++ and r0 = 0
!reset_check
cmp r0 100
jls !main
add r1 1
mov r0 0
jmp !main

; Move forward & turn clockwise
!forward
mov r2 MOVE_SPEED
store P_SPEDOMETER r2
jmp !reset_check

; Move backwards & turn counter clockwise
!backward
mov r2 MOVE_SPEED
neg r2
store P_SPEDOMETER r2
mov r2 1
store P_SHOOT r2
mov r2 0
store P_TURRET_ABS r2 ; Keep turret facing east when going backwards
mov r2 0xFFFF
store P_MINELAYER r2
jmp !reset_check